var y=Object.defineProperty;var w=(n,t,e)=>t in n?y(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>w(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const c=50,u={x:354,y:752};class m{constructor(t,e){this.coordinates=t,this.color=e}}function C(n){const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("Canvas context is not available.");t.width=n.width,t.height=n.height,e.drawImage(n,0,0,n.width,n.height);const i=e.getImageData(0,0,n.width,n.height),s=[];for(let a=0;a<n.height;a++){const o=[];for(let h=0;h<n.width;h++){const l=(a*n.width+h)*4,g=i.data[l],v=i.data[l+1],p=i.data[l+2],f=i.data[l+3],x=new m({x:h,y:a},{r:g,g:v,b:p,a:f});o.push(x)}s.push(o)}return s}class b{constructor(t){r(this,"canvas");r(this,"ctx");r(this,"scale",1);r(this,"translate",{x:0,y:0});r(this,"field",[]);r(this,"isDragging",!1);r(this,"dragStart",{x:0,y:0});r(this,"lastTranslate",{x:0,y:0});r(this,"activePixel",null);r(this,"pinchStartDistance",null);r(this,"onActivePixelChange",null);const e=this.createCanvas(),i=e.getContext("2d");if(!i)throw new Error("Cannot create Canvas context. Enable Javascript or Hardware acceleration if it's disabled.");this.canvas=e,this.ctx=i;const s=C(t);this.field=s,this.applyListeners()}createCanvas(){const t=document.createElement("canvas");return t.style.cssText=`
      display: block;
      padding: 0px;
      margin: 0px;
      width: 100vw;
      height: 100vh;
    `,t.width=window.innerWidth,t.height=window.innerHeight,t}appendCanvas(t){t.appendChild(this.canvas)}getCanvasBoundings(){return this.canvas.getBoundingClientRect()}clearCanvas(){const{width:t,height:e}=this.getCanvasBoundings();this.ctx.clearRect(0,0,t,e)}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.canvas.style.width="100vw",this.canvas.style.height="100vh"}applyListeners(){window.addEventListener("resize",this.resizeCanvas.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("wheel",this.onWheel.bind(this)),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mouseleave",this.onMouseUp.bind(this)),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.onTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.onTouchEnd.bind(this)),this.canvas.addEventListener("gesturestart",this.onGestureStart.bind(this)),this.canvas.addEventListener("gesturechange",this.onGestureChange.bind(this))}onGestureStart(t){t.preventDefault(),this.pinchStartDistance=this.getDistance(t.touches)}onGestureChange(t){if(t.preventDefault(),this.pinchStartDistance!==null){const e=this.getDistance(t.touches),i=e/this.pinchStartDistance;this.scale*=i,this.pinchStartDistance=e,this.render()}}getDistance(t){const e=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.sqrt(e*e+i*i)}onMouseMove(t){this.isDragging?this.onMouseMoveDrag(t):this.detectActivePixel(t)}onMouseMoveDrag(t){const e=t.clientX-this.dragStart.x,i=t.clientY-this.dragStart.y;this.translate.x=this.lastTranslate.x+e,this.translate.y=this.lastTranslate.y+i,this.render()}onMouseDown(t){this.isDragging=!0,this.dragStart={x:t.clientX,y:t.clientY},this.lastTranslate={...this.translate}}onMouseUp(){this.isDragging=!1}onTouchStart(t){if(t.touches.length===1){const e=t.touches[0];this.isDragging=!0,this.dragStart={x:e.clientX,y:e.clientY},this.lastTranslate={...this.translate}}}onTouchMove(t){if(this.isDragging&&t.touches.length===1){const e=t.touches[0],i=e.clientX-this.dragStart.x,s=e.clientY-this.dragStart.y;this.translate.x=this.lastTranslate.x+i,this.translate.y=this.lastTranslate.y+s,this.render()}}onTouchEnd(){this.isDragging=!1}detectActivePixel(t){var h,l;const e=this.canvas.getBoundingClientRect(),i=(t.clientX-e.left-this.translate.x)/this.scale,s=(t.clientY-e.top-this.translate.y)/this.scale,a=Math.floor(i/c),o=Math.floor(s/c);a>=0&&o>=0&&o<this.field.length&&a<this.field[0].length?(this.activePixel=this.field[o][a],(h=this.onActivePixelChange)==null||h.call(this,this.activePixel)):(this.activePixel=null,(l=this.onActivePixelChange)==null||l.call(this,null)),this.render()}onWheel(t){t.preventDefault();const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,a=.1,o=t.deltaY<0?1+a:1-a;this.translate.x-=(i-this.translate.x)*(o-1),this.translate.y-=(s-this.translate.y)*(o-1),this.scale*=o,this.render()}drawImage(){for(const t of this.field)for(const e of t)this.ctx.fillStyle=`rgba(${e.color.r},${e.color.g},${e.color.b},1)`,this.ctx.fillRect(e.coordinates.x*c,e.coordinates.y*c,c,c);if(this.activePixel){const{x:t,y:e}=this.activePixel.coordinates;this.ctx.strokeStyle="rgba(255, 0, 255, 1)",this.ctx.lineWidth=2,this.ctx.strokeRect(t*c,e*c,c,c)}}applyTransforms(){this.ctx.setTransform(this.scale,0,0,this.scale,this.translate.x,this.translate.y)}render(){this.clearCanvas(),this.applyTransforms(),this.drawImage()}update(){}play(){this.update(),this.render(),window.requestAnimationFrame(this.play.bind(this))}}const d=new Image;d.src="/duck_pixel/image.png";d.addEventListener("load",()=>{const n=new b(d);n.play(),n.appendCanvas(document.body);const t=document.getElementById("pixel_info");n.onActivePixelChange=e=>{if(t.innerHTML="",!e){t.innerHTML="";return}const i=document.createElement("div");i.innerText=`Coordinates: (${e.coordinates.x+u.x}:${e.coordinates.y+u.y}) `;const s=document.createElement("div");s.innerText=`Color: rgba(${e.color.r}, ${e.color.g}, ${e.color.b}, 1)`,t.appendChild(i),t.appendChild(s)}});
